{% extends "base.html" %}

{% block content %}
<!-- Action Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-4">
        <a href="/ingest" class="action-card">
            <div class="icon-wrapper primary">
                <i class="fas fa-cloud-download-alt"></i>
            </div>
            <h3>Ingestão</h3>
            <p>Baixar dados históricos</p>
        </a>
    </div>
    
    <div class="col-md-4">
        <a href="/train" class="action-card">
            <div class="icon-wrapper success">
                <i class="fas fa-brain"></i>
            </div>
            <h3>Treinamento</h3>
            <p>Criar modelos LSTM</p>
        </a>
    </div>
    
    <div class="col-md-4">
        <a href="/predict" class="action-card">
            <div class="icon-wrapper info">
                <i class="fas fa-magic"></i>
            </div>
            <h3>Predição</h3>
            <p>Consultar futuro</p>
        </a>
    </div>
</div>

<!-- History Section -->
<div class="card">
    <div class="card-header">
        <h5><i class="fas fa-history me-2"></i>Histórico de Previsões</h5>
        <a href="/history" class="btn btn-link btn-sm">Ver tudo</a>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="history-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ticker</th>
                        <th>Preço Previsto</th>
                        <th>Data da Previsão</th>
                        <th>Modelo Usado</th>
                    </tr>
                </thead>
                <tbody id="history-body">
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">
                            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                            Carregando...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        loadHistory();
    });
    
    async function loadHistory() {
        const tbody = document.getElementById('history-body');
        tbody.innerHTML = `<tr><td colspan="5" class="text-center text-muted py-4">
            <div class="spinner-border spinner-border-sm me-2" role="status"></div>Carregando...</td></tr>`;
        
        try {
            // Load predictions history
            const predictionsRes = await axios.get('/api/v1/predictions/history?limit=10');
            const predictions = predictionsRes.data.predictions || [];
            
            if (predictions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted py-4">Nenhuma previsão encontrada</td></tr>';
                return;
            }
            
            tbody.innerHTML = predictions.map((p, index) => `
                <tr>
                    <td>#${index + 1}</td>
                    <td><span class="badge bg-primary">${p.ticker}</span></td>
                    <td>R$ ${p.predicted_price.toFixed(2)}</td>
                    <td>
                        <i class="fas fa-clock me-1 text-muted"></i>
                        ${new Date(p.prediction_date).toLocaleDateString('pt-BR')}, ${new Date(p.prediction_date).toLocaleTimeString('pt-BR')}
                    </td>
                    <td>
                        <a href="#" class="text-primary">${p.model_path ? p.model_path.split('/').pop() : 'N/A'}</a>
                    </td>
                </tr>
            `).join('');
            
        } catch (error) {
            console.error(error);
            tbody.innerHTML = '<tr><td colspan="5" class="text-center text-danger py-4">Erro ao carregar histórico</td></tr>';
        }
    }
</script>
{% endblock %}